<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.cpi2.controllers.PaymentHistory"
            stylesheets="@/css/style.css"
            styleClass="root">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <top>
        <VBox alignment="CENTER" spacing="10">
            <Label text="Historique des Paiements" styleClass="page-title"/>
            <Separator />
        </VBox>
    </top>

    <center>
        <VBox spacing="20">
            <HBox alignment="CENTER" spacing="20">
                <VBox spacing="10" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="Candidat:" styleClass="form-label"/>
                        <ComboBox fx:id="candidatComboBox" promptText="Tous les candidats" prefWidth="220"/>
                        
                        <Label text="Type:" styleClass="form-label"/>
                        <ComboBox fx:id="typeComboBox" promptText="Tous les types" prefWidth="180"/>
                        
                        <Label text="Période:" styleClass="form-label"/>
                        <DatePicker fx:id="dateDebutPicker" promptText="Date début"/>
                        <Label text="à"/>
                        <DatePicker fx:id="dateFinPicker" promptText="Date fin"/>
                        
                        <Button text="Filtrer" onAction="#handleFilter" styleClass="action-button"/>
                    </HBox>
                </VBox>
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <Button text="Exporter PDF" onAction="#handleExportPDF" styleClass="action-button"/>
                    <Button text="Génerer Facture" onAction="#handleCreateInvoice" styleClass="action-button"/>
                </HBox>
            </HBox>
            
            <HBox spacing="20" VBox.vgrow="ALWAYS">
                <!-- Payment List -->
                <VBox spacing="10" HBox.hgrow="ALWAYS">
                    <Label text="Liste des Paiements" styleClass="section-title"/>
                    <TableView fx:id="paymentsTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="idColumn" text="ID" prefWidth="60"/>
                            <TableColumn fx:id="dateColumn" text="Date" prefWidth="100"/>
                            <TableColumn fx:id="candidatColumn" text="Candidat" prefWidth="150"/>
                            <TableColumn fx:id="montantColumn" text="Montant" prefWidth="100"/>
                            <TableColumn fx:id="typeColumn" text="Type" prefWidth="120"/>
                            <TableColumn fx:id="methodeColumn" text="Méthode" prefWidth="100"/>
                            <TableColumn fx:id="statutColumn" text="Statut" prefWidth="80"/>
                            <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="100"/>
                        </columns>
                    </TableView>
                </VBox>
                
                <!-- Payment Summary -->
                <VBox spacing="10" prefWidth="300" styleClass="summary-panel">
                    <Label text="Résumé des Paiements" styleClass="section-title"/>
                    
                    <TitledPane text="Statistiques" expanded="true">
                        <VBox spacing="15" styleClass="summary-content">
                            <HBox styleClass="summary-row">
                                <Label text="Total des paiements:" styleClass="summary-label"/>
                                <Label fx:id="totalPaymentsLabel" text="0" styleClass="summary-value"/>
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label text="Montant total:" styleClass="summary-label"/>
                                <Label fx:id="totalAmountLabel" text="0.00 DT" styleClass="summary-value"/>
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label text="Paiements complétés:" styleClass="summary-label"/>
                                <Label fx:id="completedPaymentsLabel" text="0" styleClass="summary-value"/>
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label text="Paiements en attente:" styleClass="summary-label"/>
                                <Label fx:id="pendingPaymentsLabel" text="0" styleClass="summary-value"/>
                            </HBox>
                        </VBox>
                    </TitledPane>
                    
                    <TitledPane text="Répartition par type" expanded="true">
                        <BarChart fx:id="typeDistributionChart" 
                                  legendVisible="false" 
                                  animated="false" 
                                  prefHeight="200">
                            <xAxis>
                                <CategoryAxis side="BOTTOM" />
                            </xAxis>
                            <yAxis>
                                <NumberAxis side="LEFT" />
                            </yAxis>
                        </BarChart>
                    </TitledPane>
                </VBox>
            </HBox>
        </VBox>
    </center>
</BorderPane> 