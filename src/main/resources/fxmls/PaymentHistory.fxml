<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>

<BorderPane styleClass="root" stylesheets="@/css/style.css" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.cpi2.controllers.PaymentHistory">

    <padding>
        <Insets bottom="20" left="20" right="20" top="20" />
    </padding>

    <top>
        <VBox alignment="CENTER" spacing="10">
            <HBox alignment="CENTER" spacing="10">
                <ImageView fitHeight="60.0" fitWidth="60.0" preserveRatio="true">
                    <Image url="@/images/logo4.png"/>
                </ImageView>
                <Label styleClass="page-title" text="Historique des Paiements" />
            </HBox>
            <Separator />
        </VBox>
    </top>

    <center>
        <VBox spacing="20">
            <HBox alignment="CENTER" spacing="20">
                <VBox alignment="CENTER_LEFT" spacing="10" HBox.hgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label styleClass="form-label" text="Candidat:" />
                        <ComboBox fx:id="candidatComboBox" prefWidth="220" promptText="Tous les candidats" />
                        
                        <Label styleClass="form-label" text="Type:" />
                        <ComboBox fx:id="typeComboBox" prefWidth="180" promptText="Tous les types" />
                        
                        <Label styleClass="form-label" text="Période:" />
                        <DatePicker fx:id="dateDebutPicker" promptText="Date début" />
                        <Label text="à" />
                        <DatePicker fx:id="dateFinPicker" promptText="Date fin" />
                        
                        <Button onAction="#handleFilter" styleClass="action-button" text="Filtrer" />
                    </HBox>
                </VBox>
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <Button onAction="#handleExportPDF" styleClass="action-button" text="Exporter PDF" />
                    <Button onAction="#handleCreateInvoice" styleClass="action-button" text="Génerer Facture" />
                </HBox>
            </HBox>
            
            <HBox spacing="20" VBox.vgrow="ALWAYS">
                
                <VBox spacing="10" HBox.hgrow="ALWAYS">
                    <Label styleClass="section-title" text="Liste des Paiements" />
                    <TableView fx:id="paymentsTable" prefHeight="400.0" prefWidth="18.0" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="idColumn" prefWidth="60" text="ID" />
                            <TableColumn fx:id="dateColumn" prefWidth="100" text="Date" />
                            <TableColumn fx:id="candidatColumn" prefWidth="150" text="Candidat" />
                            <TableColumn fx:id="montantColumn" prefWidth="100" text="Montant" />
                            <TableColumn fx:id="typeColumn" prefWidth="120" text="Type" />
                            <TableColumn fx:id="methodeColumn" prefWidth="100" text="Méthode" />
                            <TableColumn fx:id="statutColumn" prefWidth="80" text="Statut" />
                            <TableColumn fx:id="actionsColumn" prefWidth="250" text="Actions" />
                        </columns>
                    </TableView>
                </VBox>
                
                
                <VBox prefWidth="300" spacing="10" styleClass="summary-panel">
                    <Label styleClass="section-title" text="Résumé des Paiements" />
                    
                    <TitledPane expanded="true" text="Statistiques">
                        <VBox spacing="15" styleClass="summary-content">
                            <HBox styleClass="summary-row">
                                <Label styleClass="summary-label" text="Total des paiements:" />
                                <Label fx:id="totalPaymentsLabel" styleClass="summary-value" text="0" />
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label styleClass="summary-label" text="Montant total:" />
                                <Label fx:id="totalAmountLabel" styleClass="summary-value" text="0.00 DT" />
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label styleClass="summary-label" text="Paiements complétés:" />
                                <Label fx:id="completedPaymentsLabel" styleClass="summary-value" text="0" />
                            </HBox>
                            <HBox styleClass="summary-row">
                                <Label styleClass="summary-label" text="Paiements en attente:" />
                                <Label fx:id="pendingPaymentsLabel" styleClass="summary-value" text="0" />
                            </HBox>
                        </VBox>
                    </TitledPane>
                    
                    <TitledPane expanded="true" text="Répartition par type">
                        <BarChart fx:id="typeDistributionChart" animated="false" legendVisible="false" prefHeight="200">
                            <xAxis>
                                <CategoryAxis side="BOTTOM" />
                            </xAxis>
                            <yAxis>
                                <NumberAxis side="LEFT" />
                            </yAxis>
                        </BarChart>
                    </TitledPane>
                </VBox>
            </HBox>
        </VBox>
    </center>
</BorderPane>

