<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.shape.Circle?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            stylesheets="@/css/style.css, @/css/notifications.css"
            fx:controller="org.cpi2.controllers.Notifications"
            styleClass="main-container">

    <top>
        <VBox spacing="15" styleClass="header-container">
            <padding>
                <Insets top="20" right="25" bottom="15" left="25"/>
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="20">
                <Label text="Centre de Notifications" styleClass="page-title"/>
                <Circle styleClass="status-indicator-online" radius="5"/>
                <Label text="En ligne" styleClass="status-text"/>
                <Region HBox.hgrow="ALWAYS"/>
                <StackPane>
                    <Circle fx:id="notificationIndicator" radius="8" styleClass="notification-indicator" visible="false"/>
                    <Label fx:id="totalNotificationsLabel" text="0" styleClass="notification-counter"/>
                </StackPane>
                <Button fx:id="refreshBtn" styleClass="action-button" onAction="#handleRefresh">
                    <graphic>
                        <Label text="↻" styleClass="icon-label">
                            <font>
                                <Font name="System Bold" size="14.0"/>
                            </font>
                        </Label>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Actualiser"/>
                    </tooltip>
                </Button>
            </HBox>
        </VBox>
    </top>

    <center>
        <StackPane>
            
            <VBox styleClass="content-card">
                <padding>
                    <Insets top="20" right="25" bottom="20" left="25"/>
                </padding>
                
                
                <HBox spacing="15" alignment="CENTER_LEFT" styleClass="search-bar">
                    <HBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS" styleClass="search-field-container">
                        <Label text="🔍" styleClass="search-icon"/>
                        <TextField fx:id="searchField" promptText="Rechercher des notifications..." 
                                 HBox.hgrow="ALWAYS" onKeyReleased="#handleSearch" styleClass="search-field"/>
                    </HBox>
                    <ComboBox fx:id="filterTypeComboBox" promptText="Type" prefWidth="130" 
                             onAction="#handleFilterChange" styleClass="filter-combo"/>
                    <ComboBox fx:id="filterStatusComboBox" promptText="Statut" prefWidth="130" 
                             onAction="#handleFilterChange" styleClass="filter-combo"/>
                </HBox>
                
                <Separator styleClass="light-separator">
                    <VBox.margin>
                        <Insets top="15" bottom="15"/>
                    </VBox.margin>
                </Separator>
                
                
                <HBox spacing="25" VBox.vgrow="ALWAYS">
                    
                    <VBox spacing="15" HBox.hgrow="ALWAYS" styleClass="notifications-container">
                        <HBox alignment="CENTER_LEFT">
                            <Label text="Notifications" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <HBox styleClass="tab-selector">
                                <Button text="Récentes" styleClass="tab-button, tab-selected" onAction="#showRecentTab"/>
                                <Button text="À venir" styleClass="tab-button" onAction="#showUpcomingTab"/>
                                <Button text="Traitées" styleClass="tab-button" onAction="#showProcessedTab"/>
                            </HBox>
                        </HBox>
                        
                        <StackPane VBox.vgrow="ALWAYS">
                            
                            <ListView fx:id="recentNotificationsListView" VBox.vgrow="ALWAYS" styleClass="card-list-view"/>
                            <ListView fx:id="upcomingNotificationsListView" VBox.vgrow="ALWAYS" styleClass="card-list-view" visible="false"/>
                            <ListView fx:id="processedNotificationsListView" VBox.vgrow="ALWAYS" styleClass="card-list-view" visible="false"/>
                            
                            
                            <StackPane fx:id="emptyPlaceholder" styleClass="empty-placeholder" visible="false">
                                <VBox spacing="15" alignment="CENTER" maxWidth="300">
                                    <Label text="📭" styleClass="empty-icon">
                                        <font>
                                            <Font size="48.0"/>
                                        </font>
                                    </Label>
                                    <Label text="Aucune notification" styleClass="empty-title"/>
                                    <Label text="Aucune notification à afficher pour le moment" 
                                           styleClass="empty-subtitle" wrapText="true" textAlignment="CENTER"/>
                                    <Button text="Actualiser" styleClass="refresh-button" onAction="#handleRefresh"/>
                                </VBox>
                            </StackPane>
                        </StackPane>
                    </VBox>
                    
                    
                    <VBox fx:id="detailsPane" spacing="20" styleClass="details-card" prefWidth="350" visible="false">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Détails" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="closeDetailsBtn" text="×" onAction="#handleCloseDetails" styleClass="close-button"/>
                        </HBox>
                        
                        <Separator styleClass="light-separator"/>
                        
                        
                        <VBox fx:id="detailsContent" spacing="20" VBox.vgrow="ALWAYS">
                            
                            <HBox styleClass="notification-banner" alignment="CENTER_LEFT" spacing="15">
                                <StackPane styleClass="type-icon-container">
                                    <Circle fx:id="typeIndicator" radius="16" styleClass="type-indicator"/>
                                    <Label fx:id="typeIconText" text="🚗" styleClass="type-icon-text">
                                        <font>
                                            <Font size="14.0"/>
                                        </font>
                                    </Label>
                                </StackPane>
                                <VBox>
                                    <Label fx:id="typeLabel" styleClass="notification-type-label"/>
                                    <Label fx:id="priorityLabel" styleClass="priority-indicator"/>
                                </VBox>
                            </HBox>
                            
                            
                            <VBox spacing="8">
                                <Label text="Titre" styleClass="detail-section-label"/>
                                <Label fx:id="titleLabel" wrapText="true" styleClass="detail-title"/>
                            </VBox>
                            
                            
                            <VBox spacing="8" VBox.vgrow="ALWAYS">
                                <Label text="Description" styleClass="detail-section-label"/>
                                <TextArea fx:id="descriptionArea" wrapText="true" editable="false" styleClass="detail-description"/>
                            </VBox>
                            
                            
                            <GridPane styleClass="info-grid" hgap="20" vgap="15">
                                
                                <VBox spacing="5" GridPane.rowIndex="0" GridPane.columnIndex="0">
                                    <HBox alignment="CENTER_LEFT" spacing="5">
                                        <Label text="📅" styleClass="field-icon"/>
                                        <Label text="Échéance" styleClass="detail-field-label"/>
                                    </HBox>
                                    <Label fx:id="dueDateLabel" styleClass="detail-field-value"/>
                                </VBox>
                                
                                
                                <VBox spacing="5" GridPane.rowIndex="0" GridPane.columnIndex="1">
                                    <HBox alignment="CENTER_LEFT" spacing="5">
                                        <Label text="🚗" styleClass="field-icon"/>
                                        <Label text="Véhicule" styleClass="detail-field-label"/>
                                    </HBox>
                                    <Label fx:id="vehicleLabel" styleClass="detail-field-value"/>
                                </VBox>
                                
                                
                                <VBox spacing="5" GridPane.rowIndex="1" GridPane.columnIndex="0">
                                    <HBox alignment="CENTER_LEFT" spacing="5">
                                        <Label text="⚡" styleClass="field-icon"/>
                                        <Label text="Statut" styleClass="detail-field-label"/>
                                    </HBox>
                                    <Label fx:id="statusLabel" styleClass="detail-field-value"/>
                                </VBox>
                                
                                
                                <VBox spacing="5" GridPane.rowIndex="1" GridPane.columnIndex="1">
                                    <HBox alignment="CENTER_LEFT" spacing="5">
                                        <Label text="🕒" styleClass="field-icon"/>
                                        <Label text="Créée le" styleClass="detail-field-label"/>
                                    </HBox>
                                    <Label fx:id="createdDateLabel" styleClass="detail-field-value"/>
                                </VBox>
                            </GridPane>
                            
                            <Region VBox.vgrow="ALWAYS"/>
                            
                            
                            <VBox spacing="10">
                                <Button fx:id="markAsHandledBtn" text="✓ Marquer comme traité" maxWidth="Infinity" 
                                        onAction="#handleMarkAsHandled" styleClass="primary-button"/>
                                
                                <Button fx:id="viewVehicleBtn" text="👁 Voir le véhicule" maxWidth="Infinity" 
                                        onAction="#handleViewVehicle" styleClass="secondary-button"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </HBox>
            </VBox>
        </StackPane>
    </center>

    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="footer-bar">
            <padding>
                <Insets top="10" right="25" bottom="10" left="25"/>
            </padding>
            <Label fx:id="notificationStats" text="0 récentes | 0 à venir | 0 traitées" styleClass="stats-text"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Hyperlink fx:id="settingsLink" text="⚙ Paramètres" onAction="#handleSettings" styleClass="settings-link"/>
        </HBox>
    </bottom>
</BorderPane>
